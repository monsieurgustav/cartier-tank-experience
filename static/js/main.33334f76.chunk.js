(this.webpackJsonpcontroller=this.webpackJsonpcontroller||[]).push([[0],{54:function(t,e,n){},55:function(t,e,n){},78:function(t,e){},87:function(t,e,n){"use strict";n.r(e);var o=n(0),i=n.n(o),c=n(45),s=n.n(c),r=(n(54),n(55),n(7)),a=n(8),h=n(13),u=n(12),l=n(2),p=n(46),d=n.n(p),v=function(){function t(e){Object(r.a)(this,t),this._socket=void 0;var n=window;n.sharedSocket||(console.log("new connection to ".concat(e)),n.sharedSocket=d()("https://cartier.vista-api.net/cartier",{query:{apikey:e},transports:["websocket"],reconnectionAttempts:15})),this._socket=n.sharedSocket,this._socket.on("connect",this.onConnected.bind(this)),this._socket.on("error",this.onError.bind(this))}return Object(a.a)(t,[{key:"start",value:function(){this._socket.emit("start")}},{key:"takePicture",value:function(){this._socket.emit("takePicture")}},{key:"leave",value:function(){this._socket.emit("leave")}},{key:"on",value:function(t,e){this._socket.on(t,e)}},{key:"off",value:function(t,e){this._socket.off(t,e)}},{key:"onConnected",value:function(){console.log("connected!")}},{key:"onError",value:function(t){console.error(t)}}]),t}();function f(t,e){var n=t.search.split("".concat(e,"="));return n.length<2?(console.error("An ".concat(e," query param is required")),""):n[1].split("&")[0]}var k=n(1),j=function(t){Object(h.a)(n,t);var e=Object(u.a)(n);function n(){var t;Object(r.a)(this,n);for(var o=arguments.length,i=new Array(o),c=0;c<o;c++)i[c]=arguments[c];return(t=e.call.apply(e,[this].concat(i))).apikey="",t.connection=void 0,t.resetStartingTimeout=void 0,t.state={starting:!1},t.onStarted=function(){t.props.history.replace("/control?apiKey=".concat(t.apikey))},t}return Object(a.a)(n,[{key:"componentDidMount",value:function(){this.apikey=f(this.props.location,"apiKey"),this.apikey&&(this.connection=new v(this.apikey),this.connection.on("onStarted",this.onStarted),this.start())}},{key:"componentWillUnmount",value:function(){var t;this.resetStartingTimeout&&clearTimeout(this.resetStartingTimeout),null===(t=this.connection)||void 0===t||t.off("onStarted",this.onStarted)}},{key:"render",value:function(){var t=this.state.starting;return Object(k.jsxs)("div",{children:[Object(k.jsx)("h2",{children:"Home"}),t?Object(k.jsx)("span",{children:"Connecting..."}):Object(k.jsx)("span",{children:"Scan the QR code"})]})}},{key:"start",value:function(){var t;null===(t=this.connection)||void 0===t||t.start();this.setState({starting:!0}),this.resetStartingTimeout&&clearTimeout(this.resetStartingTimeout),this.resetStartingTimeout=setTimeout(this.resetStarting.bind(this),2e3)}},{key:"resetStarting",value:function(){this.resetStartingTimeout&&(clearTimeout(this.resetStartingTimeout),this.resetStartingTimeout=void 0);this.setState({starting:!1})}}]),n}(i.a.PureComponent),b=Object(l.f)(j),y=function(t){Object(h.a)(n,t);var e=Object(u.a)(n);function n(){var t;Object(r.a)(this,n);for(var o=arguments.length,i=new Array(o),c=0;c<o;c++)i[c]=arguments[c];return(t=e.call.apply(e,[this].concat(i))).apikey="",t.connection=void 0,t.state={canTakePhoto:!0,photoNumber:0},t.onPhotoTaken=function(){var e=t.state.photoNumber+1;e<3&&t.setState({canTakePhoto:!0,photoNumber:e})},t.onFinish=function(e){t.props.history.replace("/result?apiKey=".concat(t.apikey,"&resultFilename=").concat(e))},t.onDisconnect=function(){t.props.history.replace("/")},t}return Object(a.a)(n,[{key:"componentDidMount",value:function(){this.apikey=f(this.props.location,"apiKey"),this.connection=new v(this.apikey),this.connection.on("onPhotoTaken",this.onPhotoTaken),this.connection.on("onFinish",this.onFinish),this.connection.on("onDisconnect",this.onDisconnect)}},{key:"componentWillUnmount",value:function(){var t,e,n;null===(t=this.connection)||void 0===t||t.off("onPhotoTaken",this.onPhotoTaken),null===(e=this.connection)||void 0===e||e.off("onFinish",this.onFinish),null===(n=this.connection)||void 0===n||n.off("onDisconnect",this.onDisconnect)}},{key:"render",value:function(){return Object(k.jsxs)("div",{children:[Object(k.jsx)("h2",{children:"Control"}),Object(k.jsxs)("button",{onClick:this.takePhoto.bind(this),disabled:!this.state.canTakePhoto,children:["Take photo ",this.state.photoNumber+1]})]})}},{key:"takePhoto",value:function(){var t;null===(t=this.connection)||void 0===t||t.takePicture();this.setState({canTakePhoto:!1})}}]),n}(i.a.PureComponent),m=n(30),S=n.n(m),O=n(48),g=function(t){Object(h.a)(n,t);var e=Object(u.a)(n);function n(){var t;Object(r.a)(this,n);for(var o=arguments.length,i=new Array(o),c=0;c<o;c++)i[c]=arguments[c];return(t=e.call.apply(e,[this].concat(i))).apikey="",t.connection=void 0,t.state={closed:!1,resultFilename:""},t.onFinish=function(){t.setState({waiting:!1})},t.onStarted=function(){t.props.history.replace("/control?apiKey=".concat(t.apikey))},t.onDisconnect=function(){t.setState({closed:!0})},t.restart=function(){var e;t.setState({closed:!0}),null===(e=t.connection)||void 0===e||e.start()},t.close=function(){var e;t.setState({closed:!0}),null===(e=t.connection)||void 0===e||e.leave()},t.share=Object(O.a)(S.a.mark((function t(){var e,n,o,i,c,s;return S.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=navigator,n=document.getElementById("resultImg"),!e.canShare){t.next=14;break}return t.next=5,fetch(n.src);case 5:return o=t.sent,t.next=8,o.blob();case 8:if(i=t.sent,c=new File([i],"Cartier Tank Experience.jpg",i),s={files:[c]},!e.canShare(s)){t.next=14;break}return e.share(s),t.abrupt("return");case 14:e.share?e.share({title:"Cartier Tank Experience",url:n.src}):console.error("Your system doesn't support sharing.");case 15:case"end":return t.stop()}}),t)}))),t}return Object(a.a)(n,[{key:"componentDidMount",value:function(){this.apikey=f(this.props.location,"apiKey"),this.connection=new v(this.apikey),this.connection.on("onStarted",this.onStarted),this.connection.on("onDisconnect",this.onDisconnect);var t=f(this.props.location,"resultFilename");this.setState({resultFilename:t})}},{key:"componentWillUnmount",value:function(){var t,e;null===(t=this.connection)||void 0===t||t.off("onStarted",this.onStarted),null===(e=this.connection)||void 0===e||e.off("onDisconnect",this.onDisconnect)}},{key:"render",value:function(){var t=this.state,e=t.closed,n=t.resultFilename;return Object(k.jsxs)("div",{children:[Object(k.jsx)("h2",{children:"Result"}),!e&&Object(k.jsxs)("div",{children:[Object(k.jsx)("button",{onClick:this.restart,children:"Restart"}),Object(k.jsx)("button",{onClick:this.close,children:"Close"}),!!navigator.share&&Object(k.jsx)("button",{onClick:this.share,children:"Share"})]}),Object(k.jsx)("img",{id:"resultImg",src:"https://cartier.vista-api.net/uploads/cartier/".concat(n)})]})}}]),n}(i.a.PureComponent),x=n(49);var T=function(){return Object(k.jsx)(x.a,{children:Object(k.jsx)("div",{children:Object(k.jsxs)(l.c,{children:[Object(k.jsx)(l.a,{path:"/control",component:y}),Object(k.jsx)(l.a,{path:"/result",component:g}),Object(k.jsx)(l.a,{path:"/",component:b})]})})})},P=function(t){t&&t instanceof Function&&n.e(3).then(n.bind(null,88)).then((function(e){var n=e.getCLS,o=e.getFID,i=e.getFCP,c=e.getLCP,s=e.getTTFB;n(t),o(t),i(t),c(t),s(t)}))};s.a.render(Object(k.jsx)(i.a.StrictMode,{children:Object(k.jsx)(T,{})}),document.getElementById("root")),P()}},[[87,1,2]]]);
//# sourceMappingURL=main.33334f76.chunk.js.map